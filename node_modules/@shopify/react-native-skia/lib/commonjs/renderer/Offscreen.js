"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.drawAsPicture = exports.drawAsImageFromPicture = exports.drawAsImage = void 0;
var _types = require("../dom/types");
var _skia = require("../skia");
var _Reconciler = require("./Reconciler");
const drawAsPicture = element => {
  const recorder = _skia.Skia.PictureRecorder();
  const canvas = recorder.beginRecording();
  const root = new _Reconciler.SkiaRoot(_skia.Skia, false);
  root.render(element);
  const ctx = new _types.JsiDrawingContext(_skia.Skia, canvas);
  root.dom.render(ctx);
  const picture = recorder.finishRecordingAsPicture();
  return picture;
};
exports.drawAsPicture = drawAsPicture;
const drawAsImage = (element, size) => {
  return drawAsImageFromPicture(drawAsPicture(element), size);
};

// TODO: We're not sure yet why PixelRatio is not needed here.
exports.drawAsImage = drawAsImage;
const pd = 1;
const drawAsImageFromPicture = (picture, size) => {
  "worklet";

  const surface = _skia.Skia.Surface.MakeOffscreen(size.width * pd, size.height * pd);
  const canvas = surface.getCanvas();
  canvas.scale(pd, pd);
  canvas.drawPicture(picture);
  surface.flush();
  return surface.makeImageSnapshot();
};
exports.drawAsImageFromPicture = drawAsImageFromPicture;
//# sourceMappingURL=Offscreen.js.map